This code was primarily written by Santiago Zanella-Beguelin (MSR).