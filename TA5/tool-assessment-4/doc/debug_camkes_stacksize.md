# Debugging the CAmkES Thread Stack Size

During development of the CASE applications on the seL4 platform, we have
observed that on occasion an application will silently crash while executing
on the target hardware or within QEMU emulation. HAMR system build generation
by default includes debugging statements (simple printf's) that indicate
when the stages of initialization have completed, and during a silent crash,
the application will fail to complete the pre-initialization of one or
more of the threads. We have observed this behavior more often when
raw bit codec connections are used on ports.

Often this crash is caused by one or more thread exhausting its stack space.
By default, CAmkES allocates 100880 bytes per thread. There are two ways to
increase the thread stack space. First, you can modify the stack size of
a thread directly in the AADL model using the `Memory_Properties::Stack_Size`
property, for example:

    thread WaypointPlanManagerService_thr
      ...
      properties
      ...
        Stack_Size => 102400 bytes;
    end WaypointPlanManagerService_thr;

Alternatively, you can edit the top-level *settings.cmake* file (generated by HAMR)
that is in the root of the CAmkES project direction by adding the line

    set(CAmkESDefaultStackSize 102400 CACHE STRING "" FORCE)

Through trial-and-error, you can continue to increase the stack size value
by 4K byte increments until the threads have enough stack space
(CAmkES aligns memory for threads in 4K blocks).

<!-- JUNE 10, 2021 -->
